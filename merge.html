<!DOCTYPE html>
<html lang="en">
<head>
    <script src="https://d3js.org/d3.v3.min.js" charset="utf-8"></script>
    <script src="https://labratrevenge.com/d3-tip/javascripts/d3.tip.v0.6.3.js"></script>
    <link rel="stylesheet" href="https://ajax.googleapis.com/ajax/libs/angular_material/1.0.0/angular-material.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.4.8/angular.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.4.8/angular-animate.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.4.8/angular-aria.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.4.8/angular-messages.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/angular_material/1.0.0/angular-material.min.js"></script>
    <link rel="stylesheet" href="style.css">
    <meta charset="UTF-8">
    <title>Title</title>
    <style>
        body {
            font: 10px sans-serif;
        }

        .axis path,
        .axis line {
            fill: none;
            stroke: #000;
            shape-rendering: crispEdges;
        }

        .bar {
            fill: orange;
        }

        .bar:hover {
            fill: orangered ;
        }

        .x.axis path {
            display: none;
        }

        .d3-tip {
            line-height: 1;
            font-weight: bold;
            padding: 12px;
            background: rgba(0, 0, 0, 0.8);
            color: #fff;
            border-radius: 2px;
        }

        /* Creates a small triangle extender for the tooltip */
        .d3-tip:after {
            box-sizing: border-box;
            display: inline;
            font-size: 10px;
            width: 100%;
            line-height: 1;
            color: rgba(0, 0, 0, 0.8);
            content: "\25BC";
            position: absolute;
            text-align: center;
        }

        /* Style northward tooltips differently */
        .d3-tip.n:after {
            margin: -1px 0 0 0;
            top: 100%;
            left: 0;
        }
    </style>
</head>
<body ng-app = "two" ng-controller = "control as three">
<md-toolbar class="md-warn">
    <div class="md-toolbar-tools">
        <h2 class="md-flex">Visualisation</h2>
    </div>
</md-toolbar>
<div layout="row" layout-padding class="bg-dark-blue nav-dark nav" layout-align="space-between center">
    <div>

        <md-menu>
            <md-button class="md-raised md-warn" md-menu-origin ng-click="$mdOpenMenu()">Navigation</md-button>
            <md-menu-content width="2">
                <md-menu-item>
                    <md-button href = "sort.html">Bubble Sort</md-button>
                </md-menu-item>
                <md-menu-item>
                    <md-button href = "merge.html">QuickSort</md-button>
                </md-menu-item>
                <md-menu-item>
                    <md-button href = "heap.html">Heap Sort</md-button>
                </md-menu-item>
                <md-menu-item>
                    <md-button href = "index.html">Linear Probing</md-button>
                </md-menu-item>
                <md-menu-item>
                    <md-button href = "file3.html">Double hashing</md-button>
                </md-menu-item>
            </md-menu-content>
        </md-menu>
    </div>
</div>
    <div id = "graph"></div>
<md-input-container class = "md-warn">
    <input type = "text" ng-model = "three.number" placeholder='Sorting size' ng-disabled = "three.disable">
</md-input-container>
<md-button ng-click="three.sort()"> Sort </md-button>
<script>

    angular.module("two", ['ngMaterial']).controller("control", function($timeout, $interval, $scope)
    {
        var ctrl = this;
        ctrl.disable = false;
        this.number = 200;
        var obj = this;
        obj.done = true;
        var total = 0;
        var i = 0;
        var z = 0;
        var temp_arr = [];
        var snap = 0;

        function swap(data, firstIndex, secondIndex){
            var temp = data[firstIndex];
            data[firstIndex] = data[secondIndex];
            data[secondIndex] = temp;
            temp_arr.push(data.slice());
        }
        function partition(data, left, right) {

            var pivot   = data[Math.floor((right + left) / 2)].value,
                    i       = left,
                    j       = right;


            while (i <= j) {

                while (data[i].value < pivot) {
                    i++;
                }

                while (data[j].value > pivot) {
                    j--;
                }

                if (i <= j) {
                    swap(data, i, j);
                    i++;
                    j--;
                }
            }

            return i;
        }
        function quickSort(data, left, right) {

            var index;

            if (data.length > 1) {

                left = typeof left != "number" ? 0 : left;
                right = typeof right != "number" ? data.length - 1 : right;

                index = partition(data, left, right);

                if (left < index - 1) {
                    quickSort(data, left, index - 1);
                }

                if (index < right) {
                    quickSort(data, index, right);
                }

            }

            return data;
        }


        /*function merge(data1, data2)
        {
            var data3 = [];
            var count1 = 0;
            var count2 = 0;
            while (count1 < data1.length && count2 < data2.length)
            {
                if (data1[count1].value < data2[count2].value)
                {
                    data3.push(data1[count1++]);
                }
                else
                {
                    data3.push(data2[count2++]);
                }
            }
            while (count1 < data1.length)
            {
                data3.push(data1[count1++]);
            }
            while (count2 < data2.length)
            {
                data3.push(data2[count2++]);
            }
            return data3;
        }

        function mergesort(data)
        {
            if (data.length <=  1)
            {
                return data;
            }
            draw()
            return merge(mergesort(data.splice(0, Math.floor(data.length / 2))), mergesort(data));
        }*/
        /*function bubble_sort(data)
        {
            var promise = $interval(function()
            {
                if (total == number)
                {
                    $interval.cancel(promise);
                }
                else if (obj.done)
                {
                    obj.done = false;
                    loop(data);
                }
            }, 5);
        }
        function loop(data)
        {
            count = 0
            $interval(function(count)
            {
                if (data[count].value > data[count+1].value)
                {
                    var temp = data[count];
                    data[count] = data[count+1];
                    data[count+1] = temp;
                }
                document.body.innerHTML = '';
                draw(data);
                count++;
                if (count == number-1)
                {
                    obj.done = true;
                    total++;
                }
            }, 5, number-1);
        }*/
        var data = [];
        function make() {
            for (i = 0; i < ctrl.number; i++) {
                data.push({letter: i.toString(), value: Math.floor(Math.random() * ctrl.number + 1)})
            }
        }

        function draw(data){
            var margin = {top: 40, right: 20, bottom: 30, left: 40},
                    width = 960 - margin.left - margin.right,
                    height = 500 - margin.top - margin.bottom;

            var formatPercent = d3.format("1s");

            var x = d3.scale.ordinal()
                    .rangeRoundBands([0, width], .1);

            var y = d3.scale.linear()
                    .range([height, 0]);

            var xAxis = d3.svg.axis()
                    .scale(x)
                    .orient("bottom")
                    .tickFormat("");

            var yAxis = d3.svg.axis()
                    .scale(y)
                    .orient("left")
                    .tickFormat(formatPercent);

            var tip = d3.tip()
                    .attr('class', 'd3-tip')
                    .offset([-10, 0])
                    .html(function(d) {
                        return "<strong>Value:</strong> <span style='color:red'>" + d.value + "</span>";
                    })

            var svg = d3.select("#graph").append("svg")
                    .attr("width", width + margin.left + margin.right)
                    .attr("height", height + margin.top + margin.bottom)
                    .append("g")
                    .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

            svg.call(tip);

            x.domain(data.map(function(d) { return d.letter; }));
            y.domain([0, d3.max(data, function(d) { return d.value; })]);

            svg.append("g")
                    .attr("class", "x axis")
                    .attr("transform", "translate(0," + height + ")")
                    .call(xAxis);

            svg.append("g")
                    .attr("class", "y axis")
                    .call(yAxis)
                    .append("text")
                    .attr("transform", "rotate(-90)")
                    .attr("y", 6)
                    .attr("dy", ".71em")
                    .style("text-anchor", "end")
                    .text("Value");

            svg.selectAll(".bar")
                    .data(data)
                    .enter().append("rect")
                    .attr("class", "bar")
                    .attr("x", function(d) { return x(d.letter); })
                    .attr("width", x.rangeBand())
                    .attr("y", function(d) { return y(d.value); })
                    .attr("height", function(d) { return height - y(d.value); })
                    .on('mouseover', tip.show)
                    .on('mouseout', tip.hide)


            function type(d) {
                d.value = +d.value;
                return d;
            }
        }
        //bubble_sort(data);
        this.sort = function() {
            make();
            ctrl.disable = true;
            ctrl.time = 0;
            var start = new Date().getTime();
            quickSort(data);

            var promise = $interval(function () {
                if (snap < temp_arr.length) {
                    document.getElementById("graph").innerHTML = '';
                    draw(temp_arr[snap++]);
                    var end = new Date().getTime();
                    ctrl.time = (end - start) / 1000;
                    document.getElementById("graph").innerHTML += ctrl.time + 's';
                }
                else {
                    $interval.cancel(promise);
                }
            }, 50)
        };
    });
</script>
</body>
</html>
